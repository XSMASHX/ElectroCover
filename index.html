<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Presentaci√≥n Banda</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* Estilo para el mensaje de carga de m√∫sica */
    .music-loading {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      color: white;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 20px;
      font-family: Arial, sans-serif;
      display: none; /* Oculto por defecto */
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
    
    /* Ocultar completamente el audio */
    #bgMusic {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Canvas para part√≠culas 3D -->
  <canvas id="background-canvas"></canvas>
  
  <!-- Contenedor del logo -->
  <div class="container">
    <div class="logo-wrapper">
      <img
        src="assets/Electrocover Logo.png"
        alt="Ir a m√≥dulo"
        class="clickable-logo"
        id="logo-navegacion"
      />
    </div>
  </div>

  <!-- Audio oculto (se reproduce autom√°ticamente en loop) -->
  <audio id="bgMusic" loop preload="auto">
    <source src="assets/sounds/Ciudad de la Furia Sound.mp3" type="audio/mpeg">
    <source src="assets/sounds/Ciudad de la Furia Sound.mp3" type="audio/ogg">
    <!-- Fallback si no hay audio -->
  </audio>
  
  <!-- Mensaje de carga (opcional) -->
  <div class="music-loading" id="musicLoading">üéµ Cargando m√∫sica...</div>

  <!-- Librer√≠as -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.148.0/build/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  
  <!-- Sistema de part√≠culas 3D -->
  <script src="js/bg.js"></script>
  
  <!-- Script para m√∫sica autom√°tica -->
  <script>
    // M√öSICA AUTOM√ÅTICA SIN CONTROLES
    (function() {
      'use strict';
      
      const audio = document.getElementById('bgMusic');
      const musicLoading = document.getElementById('musicLoading');
      
      // Configuraci√≥n
      audio.volume = 0.7; // Volumen al 70% (ajusta entre 0 y 1)
      audio.loop = true; // Loop infinito
      audio.autoplay = true; // Intentar autoplay
      audio.preload = 'auto'; // Pre-cargar
      
      // Mostrar mensaje de carga
      musicLoading.style.display = 'block';
      
      // Intentar reproducir autom√°ticamente
      function iniciarMusica() {
        const playPromise = audio.play();
        
        if (playPromise !== undefined) {
          playPromise
            .then(() => {
              // √âxito: m√∫sica iniciada
              console.log('‚úÖ M√∫sica iniciada autom√°ticamente');
              musicLoading.style.display = 'none';
            })
            .catch(error => {
              // Fall√≥ autoplay, necesitamos interacci√≥n del usuario
              console.log('‚ö†Ô∏è Autoplay bloqueado. Esperando interacci√≥n...');
              
              // Estrategia 1: Intentar con clic en cualquier parte
              document.body.addEventListener('click', function iniciarConClic() {
                audio.play()
                  .then(() => {
                    console.log('‚úÖ M√∫sica iniciada por clic');
                    musicLoading.style.display = 'none';
                  })
                  .catch(e => console.error('‚ùå Error al iniciar con clic:', e));
                
                // Remover el listener despu√©s del primer clic
                document.body.removeEventListener('click', iniciarConClic);
              }, { once: true });
              
              // Estrategia 2: Intentar con el logo
              document.getElementById('logo-navegacion').addEventListener('click', function iniciarConLogo() {
                audio.play()
                  .then(() => {
                    console.log('‚úÖ M√∫sica iniciada por logo');
                    musicLoading.style.display = 'none';
                  });
              }, { once: true });
              
              // Estrategia 3: Intentar autom√°ticamente despu√©s de 2 segundos
              setTimeout(() => {
                audio.play().catch(e => {
                  console.log('‚ö†Ô∏è A√∫n no se puede reproducir...');
                });
              }, 2000);
            });
        }
      }
      
      // Evento cuando la canci√≥n se carga
      audio.addEventListener('loadeddata', () => {
        console.log('üéµ Audio cargado, intentando reproducir...');
        iniciarMusica();
      });
      
      // Evento de error
      audio.addEventListener('error', (e) => {
        console.error('‚ùå Error cargando audio:', audio.error);
        musicLoading.textContent = '‚ùå Error cargando m√∫sica';
        musicLoading.style.background = 'rgba(255, 50, 50, 0.7)';
        
        // Verificar el error
        switch(audio.error.code) {
          case 1:
            console.error('MEDIA_ERR_ABORTED: El usuario cancel√≥');
            break;
          case 2:
            console.error('MEDIA_ERR_NETWORK: Error de red');
            break;
          case 3:
            console.error('MEDIA_ERR_DECODE: Error al decodificar');
            break;
          case 4:
            console.error('MEDIA_ERR_SRC_NOT_SUPPORTED: Formato no soportado o archivo no encontrado');
            console.log('üîç Verifica que assets/musica.mp3 existe');
            break;
        }
      });
      
      // Evento cuando empieza a reproducir
      audio.addEventListener('play', () => {
        console.log('‚ñ∂Ô∏è M√∫sica reproduci√©ndose en loop');
      });
      
      // Evento para cada loop
      audio.addEventListener('ended', () => {
        console.log('üîÑ Loop completado, reiniciando...');
      });
      
      // Iniciar cuando la p√°gina cargue
      window.addEventListener('DOMContentLoaded', () => {
        console.log('üöÄ P√°gina cargada, iniciando m√∫sica...');
        
        // Si el audio ya est√° listo, intentar reproducir
        if (audio.readyState >= 2) { // HAVE_CURRENT_DATA o m√°s
          iniciarMusica();
        }
      });
      
      // EVITAR QUE EL USUARIO DETENGA LA M√öSICA
      // 1. Remover controles de contexto
      audio.removeAttribute('controls');
      
      // 2. Prevenir pausa con teclado
      document.addEventListener('keydown', (e) => {
        // Bloquear tecla espacio (pausa com√∫n)
        if (e.code === 'Space' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
          e.preventDefault();
        }
        
        // Bloquear atajos de medios (Play/Pause, Stop, etc.)
        if (e.code === 'MediaPlayPause' || e.code === 'MediaStop') {
          e.preventDefault();
        }
      });
      
      // 3. Forzar reanudaci√≥n si alguien pausa el audio
      let forcePlayInterval;
      
      function forzarReproduccion() {
        if (audio.paused && !audio.ended) {
          console.log('‚ö†Ô∏è Audio pausado, forzando reanudaci√≥n...');
          audio.play().catch(e => {
            console.log('‚ö†Ô∏è No se pudo reanudar autom√°ticamente');
          });
        }
      }
      
      // Verificar cada segundo si el audio est√° pausado
      setTimeout(() => {
        forcePlayInterval = setInterval(forzarReproduccion, 1000);
      }, 5000);
      
      // Limpiar intervalo cuando la p√°gina se cierre
      window.addEventListener('beforeunload', () => {
        if (forcePlayInterval) {
          clearInterval(forcePlayInterval);
        }
      });
      
    })();
  </script>
</body>
</html>